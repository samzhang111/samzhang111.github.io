---
layout: post
title: ansible
date: 2015-10-06 21:34:00
---

{{page.title}}
==============
{{page.date}}

This is a collection of the snags that I encountered while learning 
[Ansible](https://github.com/ansible/ansible), an IT automation
platform. 

-------------

I made a typo in my Ansible "playbook" (as the configuration files
are called).  When I ran my playbook, I got the cryptic error message,
`msg: dictionary requested, could not parse JSON or key=value`. It didn't
say which key was unparsable though.

So I patched Ansible on my local filesystem. I found the
[line](https://github.com/idano/home/blob/master/lib/ansible/module_utils/basic.py#L694)
that emitted that error, and modified it to also print out which value
was wrong. This helped me track down my problem, which was that instead
of writing:

```
instance_tags:
  Name: college-scraper
  Environment: college-scraper
```

I had

``` 
instance_tags: college-scraper 
```

I submitted a [Github
issue](https://github.com/ansible/ansible/issues/12624) about making
the error more verbose. Once it was approved, I downloaded the repo,
then discovered that the problem was already solved by the 2.0.0 release.
The version of Ansible I acquired from pip was version 1.9.3. Oh well.

-------------

I wanted to split a text file across my hosts, with each host receiving
a unique fraction of lines.

This was tricky because it really was a framing problem. I didn't know
how to ask the question I was looking for, and besides, there could be
multiple ways of doing the same thing.

My first thought was: is there an incrementing integer for each of my
hosts? If so, I can break my file up, with incrementing numeric suffixes
for the total number of hosts, then copy them over using the host index.

Then I backtracked and wondered whether there was a magic file
partitioning module in Ansible itself.

I spent some time following dead-ends, such as looking for this
non-existent file partitioning module, and getting confused by the
built-in `loop_with_index` directive in Ansible.

Anyway, it turns out [EC2 hosts maintain an ami_launch_index property
themselves](http://stackoverflow.com/questions/32929823/partitioning-data-across-hosts-in-ansible-access-index-of-host-in-task).
I even figured out how to access the variable, sort of just by fumbling
around.  It's an amazing phenomenon to me how asking a question out loud
will often cause me to think of the answer myself right away. I'd like
to see a study about that, come to think of it.
